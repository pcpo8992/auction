<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>æ–°åŒ—åˆ†ç½²å‹•ç”¢æ‹è³£ç«¶è²·äººå–Šåƒ¹æ­·ç¨‹</title>
    <style>
        body {
  margin: 0;
  min-width: 250px;
  background: linear-gradient(180deg, #f8f9fa 0%, #e6f0eb 100%);
  font-family: "Microsoft JhengHei", "Noto Sans TC", sans-serif;
  color: #222;
  overflow-x: hidden;
}

h2 {
  margin: 15px;
  text-align: center;
  font-size: 2.4em;
  color: #c9302c;
  letter-spacing: 2px;
  text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
}

h3 {
  text-align: center;
  font-size: 1.3em;
  color: #555;
}

/* å‡ºåƒ¹å€å¡Š */
.price {
  width: 100%;
  height: 400px;
  background: linear-gradient(120deg, #2b6777, #52ab98);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  border-radius: 0 0 30px 30px;
  box-shadow: 0px 4px 20px rgba(0,0,0,0.2);
  position: relative;
  overflow: hidden;
}

.title {
  height: 80px;
  line-height: 80px;
  font-size: 2em;
  color: #fff;
  text-shadow: 0px 0px 6px rgba(0,0,0,0.3);
}

.nowPrice {
  font-size: 6em;
  color: #fff;
  font-weight: bold;
  letter-spacing: 4px;
  text-shadow: 0px 0px 20px rgba(255,255,255,0.6);
  animation: pricePulse 1s infinite alternate;
}

/* é‡‘é¡è·³å‹•å‹•ç•« */
@keyframes pricePulse {
  0% { transform: scale(1); opacity: 0.9; }
  100% { transform: scale(1.05); opacity: 1; }
}

/* åˆ—è¡¨æ¨£å¼ */
ul {
  margin: 20px auto;
  padding: 0;
  max-width: 700px;
  width: 90%;
  list-style-type: none;
}

ul li {
  background: #fff8e1;
  border-radius: 12px;
  padding: 15px 25px;
  margin: 10px 0;
  font-size: 1.6em;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
  border-left: 10px solid #f0ad4e;
}

ul li:hover {
  transform: translateY(-3px);
  background: #fff3cd;
}

ul li.check {
  background: #ffe066;
  font-size: 2em;
  font-weight: bold;
  border-left: 10px solid #ffc107;
  box-shadow: 0px 0px 12px rgba(0,0,0,0.4);
  animation: flashNew 1s ease-in-out 3;
}

/* æœ€æ–°å‡ºåƒ¹é–ƒçˆæ•ˆæœ */
@keyframes flashNew {
  0%, 100% { background-color: #ffe066; }
  50% { background-color: #fff9c4; }
}

/* åº•éƒ¨åœ–æ¨£ */
.picture {
  display: flex;
  justify-content: center;
  position: fixed;
  bottom: 0;
  width: 100%;
  background: rgba(255,255,255,0.9);
  padding: 10px 0;
}

.picture img {
  width: 35%;
  max-width: 300px;
  filter: drop-shadow(0px 2px 5px rgba(0,0,0,0.3));
}

/* ===== å¾—æ¨™æ…¶ç¥ç‰¹æ•ˆ ===== */
.celebration-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.85);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  animation: fadeIn 0.5s ease;
}

.celebration-overlay.active {
  display: flex;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.celebration-content {
  text-align: center;
  position: relative;
  z-index: 10000;
}

.celebration-title {
  font-size: 5em;
  color: #FFD700;
  font-weight: bold;
  text-shadow: 0 0 30px rgba(255, 215, 0, 0.8),
               0 0 60px rgba(255, 215, 0, 0.6),
               0 0 90px rgba(255, 215, 0, 0.4);
  animation: celebrationPulse 1s ease-in-out infinite;
  margin-bottom: 30px;
  letter-spacing: 8px;
}

@keyframes celebrationPulse {
  0%, 100% { 
    transform: scale(1) rotate(0deg); 
    text-shadow: 0 0 30px rgba(255, 215, 0, 0.8),
                 0 0 60px rgba(255, 215, 0, 0.6);
  }
  50% { 
    transform: scale(1.1) rotate(2deg); 
    text-shadow: 0 0 40px rgba(255, 215, 0, 1),
                 0 0 80px rgba(255, 215, 0, 0.8),
                 0 0 120px rgba(255, 215, 0, 0.6);
  }
}

.winner-info {
  font-size: 3em;
  color: #FFD700;
  margin: 20px 0;
  text-shadow: 0 0 20px rgba(255, 215, 0, 0.8),
               0 0 40px rgba(255, 215, 0, 0.5);
  animation: slideUp 1s ease-out;
  font-weight: bold;
}

@keyframes slideUp {
  from { 
    opacity: 0;
    transform: translateY(50px);
  }
  to { 
    opacity: 1;
    transform: translateY(0);
  }
}

/* å½©ç´™ç¢ç‰‡ */
.confetti {
  position: absolute;
  width: 10px;
  height: 10px;
  background: #f0ad4e;
  animation: confettiFall 3s linear infinite;
}

@keyframes confettiFall {
  to {
    transform: translateY(100vh) rotate(360deg);
    opacity: 0;
  }
}

/* ç…™ç«æ•ˆæœ */
.firework {
  position: absolute;
  width: 5px;
  height: 5px;
  border-radius: 50%;
  animation: fireworkExplode 1.5s ease-out infinite;
}

@keyframes fireworkExplode {
  0% {
    transform: translate(0, 0) scale(1);
    opacity: 1;
  }
  100% {
    transform: translate(var(--x), var(--y)) scale(0);
    opacity: 0;
  }
}

/* å…‰ç’°ç‰¹æ•ˆ */
.ring {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 200px;
  height: 200px;
  border: 5px solid rgba(255, 215, 0, 0.6);
  border-radius: 50%;
  animation: ringExpand 2s ease-out infinite;
}

@keyframes ringExpand {
  0% {
    width: 200px;
    height: 200px;
    opacity: 1;
  }
  100% {
    width: 600px;
    height: 600px;
    opacity: 0;
  }
}

/* æ˜Ÿæ˜Ÿé–ƒçˆ */
.star {
  position: absolute;
  color: #FFD700;
  font-size: 3em;
  animation: starTwinkle 1s ease-in-out infinite;
}

@keyframes starTwinkle {
  0%, 100% { 
    opacity: 1;
    transform: scale(1) rotate(0deg);
  }
  50% { 
    opacity: 0.3;
    transform: scale(1.3) rotate(180deg);
  }
}

/* éŸ³æ•ˆå•Ÿå‹•æŒ‰éˆ• */
.audio-start-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10002;
  animation: fadeIn 0.5s ease;
}

.audio-start-overlay.hidden {
  display: none;
}

.audio-start-box {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 50px 70px;
  border-radius: 20px;
  text-align: center;
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  animation: popIn 0.5s ease-out;
}

@keyframes popIn {
  0% { transform: scale(0.8); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

.audio-start-title {
  font-size: 2.5em;
  color: #fff;
  margin-bottom: 15px;
  font-weight: bold;
  text-shadow: 0 2px 10px rgba(0,0,0,0.3);
}

.audio-start-subtitle {
  font-size: 1.2em;
  color: rgba(255,255,255,0.9);
  margin-bottom: 30px;
}

.audio-start-btn {
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  color: #fff;
  border: none;
  padding: 20px 50px;
  font-size: 1.5em;
  border-radius: 50px;
  cursor: pointer;
  box-shadow: 0 10px 30px rgba(245, 87, 108, 0.4);
  transition: all 0.3s ease;
  font-weight: bold;
}

.audio-start-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 15px 40px rgba(245, 87, 108, 0.6);
}

.audio-start-btn:active {
  transform: translateY(-1px);
}

/* æ‰‹æ©Ÿç‰ˆ */
@media only screen and (max-width: 490px) {
  h2 { font-size: 1.4em; margin: 10px; }
  .title { font-size: 1.2em; height: 60px; line-height: 60px; }
  .nowPrice { font-size: 3em; line-height: 120px; }
  ul li { font-size: 1.1em; padding: 10px 15px; }
  .price { height: 250px; border-radius: 0 0 15px 15px; }
  .picture img { width: 60%; }
  
  .celebration-title { font-size: 2.5em; letter-spacing: 4px; }
  .winner-info { font-size: 1.5em; }
  
  .audio-start-box { padding: 40px 50px; }
  .audio-start-title { font-size: 1.8em; }
  .audio-start-subtitle { font-size: 1em; }
  .audio-start-btn { font-size: 1.2em; padding: 15px 40px; }
}
    </style>
  </head>
  <body>
    <!-- éŸ³æ•ˆå•Ÿå‹•ç•«é¢ -->
    <div class="audio-start-overlay" id="audioStartOverlay">
      <div class="audio-start-box">
        <div class="audio-start-title">ğŸ”Š æ‹è³£ç³»çµ±éŸ³æ•ˆ</div>
        <div class="audio-start-subtitle">é»æ“ŠæŒ‰éˆ•å•Ÿç”¨å¾—æ¨™éŸ³æ•ˆæé†’</div>
        <button class="audio-start-btn" id="audioStartBtn">é–‹å§‹æ‹è³£</button>
      </div>
    </div>

    <h2 >å‹•ç”¢æ‹è³£ç«¶è²·äººå–Šåƒ¹</h2>
    <h3></h3>
    <div class="price">
      <div class="title">å‡ºåƒ¹æœ€é«˜é‡‘é¡<span style="font-size: 0.6em;">(å–®ä½:å…ƒ)</span></div>
      <div class="nowPrice"></div>
    </div>
    <div>
      <ul id="myUL">
      </ul>
    </div>

    <!-- å¾—æ¨™æ…¶ç¥ç•«é¢ -->
    <div class="celebration-overlay" id="celebrationOverlay">
      <div class="ring"></div>
      <div class="ring" style="animation-delay: 0.5s;"></div>
      <div class="ring" style="animation-delay: 1s;"></div>
      
      <div class="celebration-content">
        <div class="star" style="top: 20%; left: 20%;">â˜…</div>
        <div class="star" style="top: 20%; right: 20%; animation-delay: 0.3s;">â˜…</div>
        <div class="star" style="bottom: 30%; left: 15%; animation-delay: 0.6s;">â˜…</div>
        <div class="star" style="bottom: 30%; right: 15%; animation-delay: 0.9s;">â˜…</div>
        
        <div class="celebration-title">ğŸ‰ æ­å–œå¾—æ¨™ ğŸ‰</div>
        <div class="winner-info" id="winnerInfo"></div>
      </div>
    </div>

    <!-- éš±è—çš„éŸ³æ•ˆå…ƒç´  -->
    <audio id="celebrationSound" preload="auto">
      <!-- ä½¿ç”¨ç·šä¸Šæ…¶ç¥éŸ³æ•ˆ -->
      <source src="./goodresult-82807.mp3" type="audio/mpeg">
    </audio>

    <div class="picture">
      <img src="./img/newTaipei.png" alt="">
    </div>
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
    <script>
      let item;
    let priceDetailArray;
    let nowPrice;
    let hasShownCelebration = false;
    let currentItemID = null;
    let audioEnabled = false;


window.onload = function() {
    nowPrice  = document.querySelector(".nowPrice");
    let i = 0;

    // éŸ³æ•ˆå•Ÿå‹•æŒ‰éˆ•äº‹ä»¶
    document.getElementById('audioStartBtn').addEventListener('click', function() {
        const audio = document.getElementById('celebrationSound');
        const overlay = document.getElementById('audioStartOverlay');
        
        if (audio) {
            // æ’­æ”¾ä¸€æ¬¡æ¸¬è©¦éŸ³(éœéŸ³)ä¾†è§£é–ç€è¦½å™¨é™åˆ¶
            audio.volume = 0.01;
            audio.play().then(() => {
                audio.pause();
                audio.currentTime = 0;
                audio.volume = 1;
                audioEnabled = true;
                console.log('âœ… éŸ³æ•ˆå·²æˆåŠŸå•Ÿç”¨!');
                
                // éš±è—å•Ÿå‹•ç•«é¢
                overlay.classList.add('hidden');
            }).catch(err => {
                console.log('âŒ éŸ³æ•ˆå•Ÿç”¨å¤±æ•—:', err);
                alert('éŸ³æ•ˆå•Ÿç”¨å¤±æ•—,è«‹é‡æ–°æ•´ç†é é¢å†è©¦ä¸€æ¬¡');
            });
        }
    });

    createDate();

    createData();

    setInterval(function() {
        createDate();
        endAuction();
    }, 1000);

};

function createDate() {
    let time = new Date();
    let finialTime = '<span style="font-size: 1.3em">(ç¾åœ¨æ™‚é–“:' + time.toLocaleString() + ') </span>';
    document.querySelector("h3").innerHTML = finialTime;
}


function numberComma(num) {
    let comma = /\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g
    return num.toString().replace(comma, ',')
}

// æ•¸å­—è½‰åœ‹å­—åŠŸèƒ½ (é›™11æ´»å‹•å°ˆç”¨)
function numberToChinese(num) {
    // å¦‚æœæƒ³æ”¹å›é€—è™Ÿæ ¼å¼,è¨»è§£æ‰é€™å€‹å‡½æ•¸å…§å®¹,æ”¹ç”¨: return numberComma(num);
    
    const digits = ['é›¶', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'ä¸ƒ', 'å…«', 'ä¹'];
    const units = ['', 'å', 'ç™¾', 'åƒ'];
    const bigUnits = ['', 'è¬', 'å„„', 'å…†'];
    
    if (num === 0) return 'é›¶';
    
    let numStr = num.toString();
    let result = '';
    let zeroFlag = false;
    
    // å°‡æ•¸å­—åˆ†æˆæ¯4ä½ä¸€çµ„
    let groups = [];
    while (numStr.length > 0) {
        groups.unshift(numStr.slice(-4));
        numStr = numStr.slice(0, -4);
    }
    
    // è™•ç†æ¯ä¸€çµ„
    for (let i = 0; i < groups.length; i++) {
        let groupNum = parseInt(groups[i]);
        let groupStr = '';
        
        if (groupNum === 0) {
            if (i < groups.length - 1) {
                zeroFlag = true;
            }
            continue;
        }
        
        // è™•ç†çµ„å…§æ•¸å­—
        let groupDigits = groups[i].split('');
        for (let j = 0; j < groupDigits.length; j++) {
            let digit = parseInt(groupDigits[j]);
            let unitIndex = groupDigits.length - 1 - j;
            
            if (digit === 0) {
                if (j < groupDigits.length - 1 && !zeroFlag) {
                    zeroFlag = true;
                }
            } else {
                if (zeroFlag) {
                    groupStr += 'é›¶';
                    zeroFlag = false;
                }
                
                // ç‰¹æ®Šè™•ç†"ä¸€å"è®Š"å"
                if (digit === 1 && unitIndex === 1 && groupStr === '' && i === groups.length - 1 && groups.length === 1) {
                    groupStr += units[unitIndex];
                } else {
                    groupStr += digits[digit] + units[unitIndex];
                }
            }
        }
        
        result += groupStr + bigUnits[groups.length - 1 - i];
        zeroFlag = false;
    }
    
    return result;
}

// æ ¼å¼åŒ–é¡¯ç¤º (é›™11æ´»å‹•å°ˆç”¨ - åœ‹å­—ç‰ˆ)
//function formatPrice(num) {     return numberToChinese(num);}

// å¦‚æœè¦æ”¹å›é€—è™Ÿæ ¼å¼,å–æ¶ˆä¸‹é¢é€™è¡Œçš„è¨»è§£,ä¸¦è¨»è§£æ‰ä¸Šé¢çš„ formatPrice å‡½æ•¸
 function formatPrice(num) { return numberComma(num); }

function createData() {
    let firebaseConfig = {
        databaseURL: "https://auction-88ffa-default-rtdb.firebaseio.com/",
    };

    // æª¢æŸ¥æ˜¯å¦å·²åˆå§‹åŒ–
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }

    let database = firebase.database();

    database.ref("/item").on('value', e => {
        item = e.val();
        if (item != null) {
            let itemArray = Object.values(item);

            while (true) {
                if (document.querySelectorAll("li").length == 0) {
                    document.querySelector('.nowPrice').textContent = '';
                    break;
                } else {
                    document.querySelectorAll("li")[0].remove();
                }
            }

            priceDetailArray = null;
            for (let i = 0; i < itemArray.length; i++) {
                if (itemArray[i].status == 2 && itemArray.endAuction == null) {
                    if (currentItemID !== itemArray[i].itemID) {
                        // åµæ¸¬åˆ°æ–°çš„æ‹è³£å“,å¼·åˆ¶é—œé–‰å‰ä¸€æ‹çš„å¾—æ¨™å‹•ç•«
                        console.log('åµæ¸¬åˆ°æ–°æ‹å“,é—œé–‰å‰ä¸€æ‹å‹•ç•«');
                        hideCelebration();
                        currentItemID = itemArray[i].itemID;
                        hasShownCelebration = false;
                    }
                    
                    if (itemArray[i].itemLeastPrice != "") {
                        //document.querySelector("h2").innerHTML = "æ‹è³£ç‰©åç¨± : " + itemArray[i].itemName + "<br>æœ€ä½åŠ åƒ¹é‡‘é¡:" + formatPrice(itemArray[i].itemLeastPrice);
                        //document.querySelector("h2").innerHTML =  itemArray[i].itemName + "<br>æœ€ä½åŠ åƒ¹é‡‘é¡:" + formatPrice(itemArray[i].itemLeastPrice);
                        document.querySelector("h2").innerHTML =  itemArray[i].itemName + "<br>æœ€ä½åŠ åƒ¹é‡‘é¡:åè¬å…ƒ";
                      } else {
                        //document.querySelector("h2").innerHTML = "æ‹è³£ç‰©åç¨± : " + itemArray[i].itemName + "<br>æœ€ä½åŠ åƒ¹é‡‘é¡:" + itemArray[i].itemLeastPrice;
                        //document.querySelector("h2").innerHTML =  itemArray[i].itemName + "<br>æœ€ä½åŠ åƒ¹é‡‘é¡:" + itemArray[i].itemLeastPrice;
                        document.querySelector("h2").innerHTML =  itemArray[i].itemName + "<br>æœ€ä½åŠ åƒ¹é‡‘é¡:åè¬å…ƒ";
                    }

                    if (itemArray[i].price_detail != null) {
                        let webId = itemArray[i].itemID;
                        let webName = itemArray[i].itemName;
                        priceDetailArray = Object.values(itemArray[i].price_detail.li);
                    }
                }
            }
            let ul = document.querySelector("#myUL");

            if (priceDetailArray != null) {
                for (let i = 0; i < priceDetailArray.length; i++) {
                    if (priceDetailArray[i]['myInputPeople'] != null) {
                        let li = document.createElement("li");
                        let finialValue = priceDetailArray[i]['myInputPeople'] + "è™Ÿç«¶è²·äºº å–Šåƒ¹ " + formatPrice(priceDetailArray[i]['myInputPrice']) + " å…ƒ";
                        let t = document.createTextNode(finialValue);
                        li.appendChild(t);
                        ul.prepend(li);
                        nowPrice.textContent = formatPrice(priceDetailArray[i]['myInputPrice']);
                    }
                }

                if (priceDetailArray.length != 0 && priceDetailArray[0]['myInputPeople'] != null) {
                    document.querySelector("li").setAttribute("class", "check");
                }

                let number = 0;
                for (let i = 0; i < priceDetailArray.length; i++) {
                    if (priceDetailArray[i]['myInputPeople'] == null) {
                        number++;
                    }
                }
                if (priceDetailArray.length == number) {
                    nowPrice.textContent = "";
                }
            }
        }
    })
}

function showCelebration(buyerNumber, finalPrice) {
    const overlay = document.getElementById('celebrationOverlay');
    const winnerInfo = document.getElementById('winnerInfo');
    const audio = document.getElementById('celebrationSound');
    
    winnerInfo.innerHTML = `${buyerNumber}è™Ÿç«¶è²·äºº<br>å¾—æ¨™é‡‘é¡: ${formatPrice(finalPrice)} å…ƒ`;
    overlay.classList.add('active');
    
    // æ’­æ”¾éŸ³æ•ˆ (åªåœ¨å·²å•Ÿç”¨æ™‚æ’­æ”¾)
    if (audio && audioEnabled) {
        audio.volume = 1;
        audio.currentTime = 0;
        
        audio.play().then(() => {
            console.log('ğŸµ éŸ³æ•ˆæ’­æ”¾æˆåŠŸ!');
        }).catch(err => {
            console.log('âš ï¸ éŸ³æ•ˆæ’­æ”¾å¤±æ•—:', err);
        });
    }
    
    createConfetti();
    createFireworks();
    
    setTimeout(() => {
        overlay.classList.remove('active');
    }, 5000);
}

function hideCelebration() {
    const overlay = document.getElementById('celebrationOverlay');
    overlay.classList.remove('active');
    
    // æ¸…é™¤æ‰€æœ‰å½©ç´™å’Œç…™ç«å…ƒç´ 
    const confettis = overlay.querySelectorAll('.confetti');
    const fireworks = overlay.querySelectorAll('.firework');
    confettis.forEach(el => el.remove());
    fireworks.forEach(el => el.remove());
    
    console.log('å·²å¼·åˆ¶é—œé–‰å¾—æ¨™å‹•ç•«');
}

function createConfetti() {
    const overlay = document.getElementById('celebrationOverlay');
    const colors = ['#FFD700', '#FFA500', '#FF6347', '#87CEEB', '#98FB98', '#DDA0DD'];
    
    for (let i = 0; i < 100; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animationDelay = Math.random() * 3 + 's';
        confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
        overlay.appendChild(confetti);
        
        setTimeout(() => confetti.remove(), 5000);
    }
}

function createFireworks() {
    const overlay = document.getElementById('celebrationOverlay');
    const colors = ['#FFD700', '#FF1493', '#00CED1', '#FF4500', '#ADFF2F'];
    
    for (let i = 0; i < 5; i++) {
        setTimeout(() => {
            const centerX = Math.random() * 80 + 10;
            const centerY = Math.random() * 60 + 20;
            
            for (let j = 0; j < 30; j++) {
                const firework = document.createElement('div');
                firework.className = 'firework';
                firework.style.left = centerX + '%';
                firework.style.top = centerY + '%';
                firework.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                const angle = (j / 30) * Math.PI * 2;
                const distance = Math.random() * 200 + 100;
                firework.style.setProperty('--x', Math.cos(angle) * distance + 'px');
                firework.style.setProperty('--y', Math.sin(angle) * distance + 'px');
                
                overlay.appendChild(firework);
                
                setTimeout(() => firework.remove(), 1500);
            }
        }, i * 400);
    }
}

function endAuction() {
    let firebaseConfig = {
        databaseURL: "https://auction-88ffa-default-rtdb.firebaseio.com/",
    };

    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    } else {
        firebase.app();
    }

    let database = firebase.database();

    database.ref("/item").once('value', e => {
        item = e.val();
        let nowNumber;
        if (item != null) {
            let itemArray = Object.values(item);

            for (let i = 0; i < itemArray.length; i++) {
                if (itemArray[i].status == 2) {
                    nowNumber = i;
                    break;
                }
            }
            
            if (nowNumber != null) {
                if (itemArray[nowNumber].status == 2 && itemArray[nowNumber].endAuction == 1) {
                    console.log("æª¢æ¸¬åˆ°æ‹è³£çµæŸ!");
                    if (!hasShownCelebration && itemArray[nowNumber].price_detail != null) {
                        const priceDetail = Object.values(itemArray[nowNumber].price_detail.li);
                        if (priceDetail.length > 0) {
                            const lastBid = priceDetail[priceDetail.length - 1];
                            if (lastBid['myInputPeople'] != null) {
                                console.log("è§¸ç™¼æ…¶ç¥ç•«é¢:", lastBid['myInputPeople'], lastBid['myInputPrice']);
                                showCelebration(lastBid['myInputPeople'], lastBid['myInputPrice']);
                                hasShownCelebration = true;
                            }
                        }
                    }
                } else if (itemArray[nowNumber].status == 2 && itemArray[nowNumber].endAuction == 2) {
                    createData();
                } else if (itemArray[nowNumber].status == 3){
                    document.querySelector('h2').textContent = 'å‹•ç”¢æ‹è³£ç«¶è²·äººå–Šåƒ¹';
                    document.querySelector('.nowPrice').textContent = '';

                    while (true) {
                        if (document.querySelectorAll("li").length == 0) {
                            break;
                        } else {
                            document.querySelectorAll("li")[0].remove();
                        }
                    }

                }else if (itemArray[nowNumber].status == 2 && itemArray[nowNumber].nopeople == 1) {
                    document.querySelector('.nowPrice').textContent = 'ç„¡äººæ‡‰è²·';
                    console.log("ç„¡äººæ‡‰è²·");
                    while (true) {
                        if (document.querySelectorAll("li").length == 0) {
                            break;
                        } else {
                            document.querySelectorAll("li")[0].remove();
                        }
                    }
                }else if (itemArray[nowNumber].status == 2 && itemArray[nowNumber].belowReserve == 1) {
                    document.querySelector('.nowPrice').textContent = 'æœªé”åº•åƒ¹';
                    console.log("æœªé”åº•åƒ¹");
                    while (true) {
                        if (document.querySelectorAll("li").length == 0) {
                            break;
                        } else {
                            document.querySelectorAll("li")[0].remove();
                        }
                    }
                } 
            } else {
                document.querySelector('h2').textContent = 'å‹•ç”¢æ‹è³£ç«¶è²·äººå–Šåƒ¹';
            }
        } 
    })
}

    </script>
  </body>
</html>
